Approach 1:

1. Define a process
2. Define the actions of the process
3. add a property frontendTemplateName which decide the template
4. define a context both in .java and .xml
5. define a Email Resolution Service both in .java and .xml which is a property of the context
6. start process

See:    http://flexblog.faratasystems.com/index.php/ecommerce-with-hybris-sending-emails/

QQ: how is context injected to template

Approach 2:
1. acceleratorservices\src\de\hybris\platform\acceleratorservices\email\impl\DefaultEmailService.java
    - EmailMessageModel *createEmailMessage*(
		+	final List\<EmailAddressModel\> toAddresses, // NOSONAR
            - EmailAddressModel *getOrCreateEmailAddressForEmail*(
                +   final String emailAddress,
                +   final String displayName )
		+	final List\<EmailAddressModel\> ccAddresses, 
        +   final List\<EmailAddressModel\> bccAddresses,
		+	final EmailAddressModel fromAddress, 
        +   final String replyToAddress, 
        +   final String subject,  *******  see 2
        +   final String body,  *******  see 2
		+	final List\<EmailAttachmentModel\> attachments  )
            - EmailAttachmentModel *createEmailAttachment*(
                +   final DataInputStream masterDataStream, 
                +   final String filename,
			    +   final String mimeType )
    - boolean *send*(final EmailMessageModel message )
2. acceleratorservices\src\de\hybris\platform\acceleratorservices\email\impl\DefaultEmailGenerationService.java

    - EmailMessageModel *generate*(
        +   final BusinessProcessModel businessProcessModel,
        +   final EmailPageModel emailPageModel )
            -   Get subject
                1.   final StringWriter subject = new StringWriter();
			    2.   rendererService().render(subjectRenderTemplate, emailContext, subject);
                  + subjectRenderTemplate = emailPageModel.getMasterTemplate().getSubject();
                  + final AbstractEmailContext<BusinessProcessModel> emailContext =     getEmailContextFactory().create(
                    -   businessProcessModel,
				    -   emailPageModel,
                    -   subjectRenderTemplate);
            -   Get body
                1.   final StringWriter body = new StringWriter();
			    2.   rendererService().render(bodyRenderTemplate, emailContext, body);

                  + bodyRenderTemplate = emailPageModel.getMasterTemplate().getHtmlTemplate();

                  + final AbstractEmailContext<BusinessProcessModel> emailContext =     getEmailContextFactory().create(
                    -   businessProcessModel,
				    -   emailPageModel,
                    -   bodyRenderTemplate);

### Summary:
There are 2 ways  to get EmailMessageModel :

1. Use DefaultEmailGenerationService.generate function, but you need the *businessProcessModel* to get emailContext
    - parameters :
        - businessProcessModel

                final OrderProcessModel businessProcessModel = (OrderProcessModel) getBusinessProcessService().createProcess(
                        processCode, fulfilmentProcessDefinitionName);

                businessProcessModel.setOrder(order);

                getModelService().save(businessProcessModel);

                //getBusinessProcessService().startProcess(businessProcessModel);

    
        - emailPageModel
            - final EmailPageModel emailPageModel = getCmsEmailPageService().getEmailPageForFrontendTemplate(
                -   getFrontendTemplateName(),
				-	contentCatalogVersion);
                    - final CatalogVersionModel catalogVersionModel = catalogVersionService.getCatalogVersion("testCatalog", "Online");

    - - parameters :frontendTemplateName, catalogVersionModel, processCode, fulfilmentProcessDefinitionName
2. Use DefaultEmailService.createEmailMessage function, just use a simple Object emailContext
    - parameters :
        - List\<EmailAddressModel\> toAddresses = String emailAddress + final String displayName
        - List\<EmailAddressModel\> ccAddresses 
        - List\<EmailAddressModel\> bccAddresses 
        - EmailAddressModel fromAddress
        - String replyToAddress
        - String subject = emailPageModel + Object emailContext
        - String body = emailPageModel + Object emailContext
        - List\<EmailAttachmentModel\> attachments = DataInputStream masterDataStream + DataInputStream masterDataStream + String mimeType


1. Create and start a process when sign up bcferriescore\src\com\bcferries\core\event\RegistrationEventListener.java
2. Excute the process base on the xml file bcferriescore\resources\bcferriescore\processes\customerRegistrationEmailProcess.xml
3. Set template name in spring xml file
bcferriescore\resources\bcferriescore-spring.xml
4. executeAction in 
acceleratorservices\src\de\hybris\platform\acceleratorservices\process\email\actions\GenerateEmailAction.java
5. executeAction in 
acceleratorservices\src\de\hybris\platform\acceleratorservices\process\email\actions\SendEmailAction.java


将templateName放进BusinessProcessModel的ContextParameters里面
在<bean id="abstractGenerateEmailAction" class="de.hybris.platform.acceleratorservices.process.email.actions.GenerateEmailAction"
	      parent="abstractAction" abstract="true">
		<property name="modelService" ref="modelService"/>
		<property name="cmsEmailPageService" ref="cmsEmailPageService"/>
		<property name="contextResolutionStrategy" ref="processContextResolutionStrategy"/>
		<property name="emailGenerationService" ref="emailGenerationService"/>
	</bean>
    旁边仿写一个，放在自己的目录里，仿写90%，更改其获取templateName的途径
                     
